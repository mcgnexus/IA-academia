<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pruebas del Chatbot - IA Sin LÃ­os</title>
  <meta name="description" content="PÃ¡gina de pruebas para validar el funcionamiento del chatbot" />
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .test-section {
      background: #f5f5f5;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .test-pass {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .test-fail {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .test-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    button {
      background: #327F4C;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #2a6a40;
    }
    .console-output {
      background: #000;
      color: #0f0;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ðŸ§ª Pruebas del Chatbot</h1>
  <p>Esta pÃ¡gina valida el funcionamiento correcto del chatbot y su botÃ³n de cierre.</p>

  <div class="test-section">
    <h2>ValidaciÃ³n de Elementos</h2>
    <div id="element-tests"></div>
    <button onclick="runElementTests()">Ejecutar Pruebas de Elementos</button>
  </div>

  <div class="test-section">
    <h2>Pruebas de Funcionalidad</h2>
    <div id="functionality-tests"></div>
    <button onclick="runFunctionalityTests()">Ejecutar Pruebas de Funcionalidad</button>
  </div>

  <div class="test-section">
    <h2>Pruebas de Eventos</h2>
    <div id="event-tests"></div>
    <button onclick="runEventTests()">Ejecutar Pruebas de Eventos</button>
  </div>

  <div class="test-section">
    <h2>Consola de DepuraciÃ³n</h2>
    <div id="console-output" class="console-output"></div>
    <button onclick="clearConsole()">Limpiar Consola</button>
  </div>

  <!-- Incluir los estilos del chatbot -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Incluir el chatbot -->
  <div class="chatFab" id="chatFab" aria-expanded="false">Chat IA</div>
  <section class="chatWidget" id="chatWidget" hidden aria-live="polite">
    <div class="chatHeader">
      <div class="chatTitle">
        <div class="chatTitle__name">Nexus-1</div>
        <div class="chatTitle__status">En lÃ­nea</div>
      </div>
      <button class="chatClose" id="chatClose" aria-label="Cerrar chat">Ã—</button>
    </div>
    <div class="chatMeta">
      <label class="field">
        <span>Tu nombre (opcional)</span>
        <input type="text" id="chatName" placeholder="Ej. Carlos" autocomplete="name" />
      </label>
      <label class="field">
        <span>WhatsApp (para enviarte las respuestas)</span>
        <input type="tel" id="chatPhone" placeholder="34XXXXXXXXX" autocomplete="tel" />
      </label>
    </div>
    <div class="chatMessages" id="chatMessages">
      <div class="msg msg--bot">
        Â¡Hola! Soy Nexus-1. Estoy procesando datos para ayudarte a optimizar tu tiempo. Â¿Quieres saber cÃ³mo la IA va a transformar tu negocio o tienes dudas sobre nuestro evento en AlmuÃ±Ã©car?
      </div>
    </div>
    <form class="chatForm" id="chatForm">
      <input type="text" id="chatInput" placeholder="Escribe tu duda..." autocomplete="off" />
      <button class="btn btn--small" type="submit">Enviar</button>
    </form>
    <div class="micro" id="chatStatus"></div>
  </section>

  <script src="app.js"></script>
  <script src="chat-validator.js"></script>
  <script>
    // Funciones de prueba
    function log(message, type = 'info') {
      const consoleOutput = document.getElementById('console-output');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.textContent = `[${timestamp}] ${message}`;
      consoleOutput.appendChild(logEntry);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    function addTestResult(containerId, testName, passed, details) {
      const container = document.getElementById(containerId);
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result test-${passed ? 'pass' : 'fail'}`;
      resultDiv.innerHTML = `<strong>${testName}:</strong> ${passed ? 'âœ… PASÃ“' : 'âŒ FALLÃ“'} - ${details}`;
      container.appendChild(resultDiv);
    }

    function runElementTests() {
      const container = document.getElementById('element-tests');
      container.innerHTML = '';
      
      log('Iniciando pruebas de elementos...');
      
      // Test 1: Verificar que todos los elementos existen
      const fab = document.getElementById('chatFab');
      const widget = document.getElementById('chatWidget');
      const closeBtn = document.getElementById('chatClose');
      
      addTestResult('element-tests', 'FAB existe', !!fab, fab ? 'Elemento encontrado' : 'Elemento no encontrado');
      addTestResult('element-tests', 'Widget existe', !!widget, widget ? 'Elemento encontrado' : 'Elemento no encontrado');
      addTestResult('element-tests', 'BotÃ³n de cierre existe', !!closeBtn, closeBtn ? 'Elemento encontrado' : 'Elemento no encontrado');
      
      // Test 2: Verificar estilos
      if (closeBtn) {
        const closeStyle = window.getComputedStyle(closeBtn);
        addTestResult('element-tests', 'BotÃ³n de cierre tiene cursor pointer', 
          closeStyle.cursor === 'pointer', `Cursor: ${closeStyle.cursor}`);
        addTestResult('element-tests', 'BotÃ³n de cierre tiene z-index adecuado', 
          parseInt(closeStyle.zIndex) > 0, `Z-index: ${closeStyle.zIndex}`);
      }
      
      log('Pruebas de elementos completadas');
    }

    function runFunctionalityTests() {
      const container = document.getElementById('functionality-tests');
      container.innerHTML = '';
      
      log('Iniciando pruebas de funcionalidad...');
      
      const fab = document.getElementById('chatFab');
      const widget = document.getElementById('chatWidget');
      const closeBtn = document.getElementById('chatClose');
      
      if (!fab || !widget || !closeBtn) {
        addTestResult('functionality-tests', 'Elementos necesarios', false, 'Faltan elementos del chatbot');
        return;
      }
      
      // Test 1: Estado inicial
      addTestResult('functionality-tests', 'Estado inicial (cerrado)', 
        widget.hidden === true, `Widget hidden: ${widget.hidden}`);
      
      // Test 2: ARIA expanded
      addTestResult('functionality-tests', 'ARIA expanded inicial', 
        fab.getAttribute('aria-expanded') === 'false', 
        `aria-expanded: ${fab.getAttribute('aria-expanded')}`);
      
      // Test 3: Abrir chat
      fab.click();
      setTimeout(() => {
        addTestResult('functionality-tests', 'Abrir chat con FAB', 
          !widget.hidden, `Widget hidden despuÃ©s de click: ${widget.hidden}`);
        
        // Test 4: Cerrar con botÃ³n
        closeBtn.click();
        setTimeout(() => {
          addTestResult('functionality-tests', 'Cerrar con botÃ³n Ã—', 
            widget.hidden === true, `Widget hidden despuÃ©s de cerrar: ${widget.hidden}`);
          
          log('Pruebas de funcionalidad completadas');
        }, 100);
      }, 100);
    }

    function runEventTests() {
      const container = document.getElementById('event-tests');
      container.innerHTML = '';
      
      log('Iniciando pruebas de eventos...');
      
      // Verificar que el validador estÃ¡ cargado
      if (typeof validateChatFunctionality === 'function') {
        const results = validateChatFunctionality();
        
        if (results.error) {
          addTestResult('event-tests', 'Validador de eventos', false, results.error);
        } else {
          addTestResult('event-tests', 'FAB es clicable', results.fabClickable, 'FAB tiene cursor pointer');
          addTestResult('event-tests', 'BotÃ³n de cierre es clicable', results.closeBtnClickable, 'BotÃ³n tiene cursor pointer');
          addTestResult('event-tests', 'Z-index FAB', results.zIndexFAB > 0, `Z-index: ${results.zIndexFAB}`);
          addTestResult('event-tests', 'Z-index Widget', results.zIndexWidget > 0, `Z-index: ${results.zIndexWidget}`);
          addTestResult('event-tests', 'Z-index Close', results.zIndexClose > 0, `Z-index: ${results.zIndexClose}`);
        }
      } else {
        addTestResult('event-tests', 'Validador cargado', false, 'La funciÃ³n validateChatFunctionality no estÃ¡ disponible');
      }
      
      log('Pruebas de eventos completadas');
    }

    function clearConsole() {
      document.getElementById('console-output').innerHTML = '';
    }

    // Auto-ejecutar pruebas bÃ¡sicas al cargar
    window.addEventListener('load', () => {
      log('PÃ¡gina de pruebas cargada');
      setTimeout(runElementTests, 500);
    });
  </script>
</body>
</html>